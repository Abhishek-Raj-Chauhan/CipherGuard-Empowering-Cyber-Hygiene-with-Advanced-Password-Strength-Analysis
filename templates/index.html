<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Password Strength Analysis</title>
    <!-- Bootstrap -->
    <link
      href="{{ url_for('static', filename = 'css/bootstrap.min.css') }}"
      rel="stylesheet"
    />
  </head>
  <style>
    body {
      background-color: black;
      color: white;
      margin: 0; /* Remove default margin */
      overflow: hidden; /* Prevent scrollbars */
      position: relative; /* Needed for absolute positioning of canvas */
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: -1; /* Place canvas behind other content */
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .header__btn {
      transition-property: all;
      transition-duration: 0.2s;
      transition-timing-function: linear;
      transition-delay: 0s;
      padding: 10px 20px;
      display: inline-block;
      margin-right: 10px;
      background-color: #fff;
      border: 1px solid #2c2c2c;
      border-radius: 3px;
      cursor: pointer;
      outline: none;
    }

    .header__btn:last-child {
      margin-right: 0;
    }

    .header__btn:hover,
    .header__btn.js-active {
      color: #fff;
      background-color: #2c2c2c;
    }

    .header {
      max-width: 600px;
      margin: 50px auto;
      text-align: center;
    }

    .header__title {
      margin-bottom: 30px;
      font-size: 2.1rem;
    }

    .content {
      height: 100vh;
      width: 100vw;
    }
    .password-strength {
      box-shadow: 0 4px 5px 0 rgba(0, 0, 0, 0.14),
        0 1px 10px 0 rgba(0, 0, 0, 0.12), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
      background-color: #000000a1;
      width: 50vw;
      height: 60vh;
      border-radius: 20px;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
    }

    .js-hidden {
      display: none;
    }
  </style>
  <body>
    <canvas></canvas>
      <!--PEN CONTENT     -->
      <div class="content text-center text-light">
        <!--content inner-->
        <div class="content__inner" style="height: 100%; width: 100%">
          <div
            class="container d-flex justify-content-center align-items-center"
            style="height: 100%; width: 100%"
          >
            <form
              class="password-strength form p-4"
              method="POST"
              action="/main/"
            >
              <h1 class="header__title">PASSWORD STRENGTH ANALYSIS</h1>
              <div
                class="form-group"
                style="
                  display: flex;
                  flex-direction: column;
                  align-items: center;
                "
              >
                <label for="password-input">Password</label>
                <div class="input-group">
                  <input
                    class="password-strength__input form-control"
                    type="text"
                    id="password-input"
                    aria-describedby="passwordHelp"
                    placeholder="Enter password"
                    name="password"
                    required
                    style="height: 4rem; border-radius: 17px"
                  />
                </div>
                <small class="password-strength__error text-danger js-hidden"
                  >This symbol is not allowed!</small
                ><small class="form-text mt-2" id="passwordHelp"
                  >Add 9 characters or more, lowercase letters, uppercase
                  letters, numbers and symbols to make the password really
                  strong!</small
                >
              </div>
              <div
                class="password-strength__bar-block progress mb-4"
                style="height: 3rem"
              >
                <div
                  class="password-strength__bar progress-bar bg-danger"
                  role="progressbar"
                  aria-valuenow="0"
                  aria-valuemin="0"
                  aria-valuemax="100"
                  style="color: black; font-weight: 600"
                ></div>
              </div>
              <div
                class="butt d-flex justify-content-center"
                style="height: 3rem"
              >
                <button
                  class="password-strength__submit btn btn-success d-flex"
                  type="submit"
                  name="submit"
                  style="
                    justify-content: center;
                    align-items: center;
                    width: 11rem;
                  "
                >
                  Submit
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    <script>
      // Initialising the canvas
      var canvas = document.querySelector("canvas"),
        ctx = canvas.getContext("2d");

      // Setting the width and height of the canvas
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      // Setting up the letters
      var letters =
        "ABCDEFGHIJKLMNOPQRSTUVXYZABCDEFGHIJKLMNOPQRSTUVXYZABCDEFGHIJKLMNOPQRSTUVXYZABCDEFGHIJKLMNOPQRSTUVXYZABCDEFGHIJKLMNOPQRSTUVXYZABCDEFGHIJKLMNOPQRSTUVXYZ";
      letters = letters.split("");

      // Setting up the columns
      var fontSize = 10,
        columns = canvas.width / fontSize;

      // Setting up the drops
      var drops = [];
      for (var i = 0; i < columns; i++) {
        drops[i] = 1;
      }

      // Setting up the draw function
      function draw() {
        ctx.fillStyle = "rgba(0, 0, 0, .1)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        for (var i = 0; i < drops.length; i++) {
          var text = letters[Math.floor(Math.random() * letters.length)];
          ctx.fillStyle = "#0f0";
          ctx.fillText(text, i * fontSize, drops[i] * fontSize);
          drops[i]++;
          if (drops[i] * fontSize > canvas.height && Math.random() > 0.95) {
            drops[i] = 0;
          }
        }
      }

      // Loop the animation
      setInterval(draw, 33);

      document.addEventListener("DOMContentLoaded", function () {
        const DOM = {
          passwForm: ".password-strength",
          passwErrorMsg: ".password-strength__error",
          passwInput: document.querySelector(".password-strength__input"),
          passwVisibilityBtn: ".password-strength__visibility",
          passwVisibility_icon: ".password-strength__visibility-icon",
          strengthBar: document.querySelector(".password-strength__bar"),
          submitBtn: document.querySelector(".password-strength__submit"),
        };

        //*** HELPERS

        //need to append classname with '.' symbol
        const findParentNode = (elem, parentClass) => {
          parentClass = parentClass.slice(1, parentClass.length);

          while (true) {
            if (!elem.classList.contains(parentClass)) {
              elem = elem.parentNode;
            } else {
              return elem;
            }
          }
        };

        //*** MAIN CODE

        const getPasswordVal = (input) => {
          return input.value;
        };

        const testPasswRegexp = (passw, regexp) => {
          return regexp.test(passw);
        };

        const testPassw = (passw) => {
          let strength = "none";
          const moderate =
            /(?=.*[A-Z])(?=.*[a-z]).{5,}|(?=.*[\d])(?=.*[a-z]).{5,}|(?=.*[\d])(?=.*[A-Z])(?=.*[a-z]).{5,}/g;
          const strong =
            /(?=.*[A-Z])(?=.*[a-z])(?=.*[\d]).{7,}|(?=.*[\!@#$%^&*()\\[\]{}\-_+=~`|:;"'<>,./?])(?=.*[a-z])(?=.*[\d]).{7,}/g;
          const extraStrong =
            /(?=.*[A-Z])(?=.*[a-z])(?=.*[\d])(?=.*[\!@#$%^&*()\\[\]{}\-_+=~`|:;"'<>,./?]).{9,}/g;

          if (testPasswRegexp(passw, extraStrong)) {
            strength = "extra";
          } else if (testPasswRegexp(passw, strong)) {
            strength = "strong";
          } else if (testPasswRegexp(passw, moderate)) {
            strength = "moderate";
          } else if (passw.length > 0) {
            strength = "weak";
          }

          return strength;
        };

        const testPasswError = (passw) => {
          const errorSymbols = /\s/g;
          return testPasswRegexp(passw, errorSymbols);
        };

        const setStrengthBarValue = (bar, strength) => {
          let strengthValue;

          switch (strength) {
            case "weak":
              strengthValue = 25;
              bar.setAttribute("aria-valuenow", strengthValue);
              break;

            case "moderate":
              strengthValue = 50;
              bar.setAttribute("aria-valuenow", strengthValue);
              break;

            case "strong":
              strengthValue = 75;
              bar.setAttribute("aria-valuenow", strengthValue);
              break;

            case "extra":
              strengthValue = 100;
              bar.setAttribute("aria-valuenow", strengthValue);
              break;

            default:
              strengthValue = 0;
              bar.setAttribute("aria-valuenow", 0);
          }

          return strengthValue;
        };

        //also adds a text label based on styles
        const setStrengthBarStyles = (bar, strengthValue) => {
          bar.style.width = `${strengthValue}%`;

          bar.classList.remove("bg-success", "bg-info", "bg-warning");

          switch (strengthValue) {
            case 25:
              bar.classList.add("bg-danger");
              bar.textContent = "Weak";
              break;

            case 50:
              bar.classList.remove("bg-danger");
              bar.classList.add("bg-warning");
              bar.textContent = "Moderate";
              break;

            case 75:
              bar.classList.remove("bg-danger");
              bar.classList.add("bg-info");
              bar.textContent = "Strong";
              break;

            case 100:
              bar.classList.remove("bg-danger");
              bar.classList.add("bg-success");
              bar.textContent = "Extra Strong";
              break;

            default:
              bar.classList.add("bg-danger");
              bar.textContent = "";
              bar.style.width = `0`;
          }
        };

        const setStrengthBar = (bar, strength) => {
          //setting value
          const strengthValue = setStrengthBarValue(bar, strength);
          //setting styles
          setStrengthBarStyles(bar, strengthValue);
        };

        const unblockSubmitBtn = (btn, strength) => {
          if (strength === "none" || strength === "weak") {
            btn.disabled = false;
          } else {
            btn.disabled = false;
          }
        };

        const findErrorMsg = (input) => {
          const passwForm = findParentNode(input, DOM.passwForm);
          return passwForm.querySelector(DOM.passwErrorMsg);
        };

        const showErrorMsg = (input) => {
          const errorMsg = findErrorMsg(input);
          errorMsg.classList.remove("js-hidden");
        };

        const hideErrorMsg = (input) => {
          const errorMsg = findErrorMsg(input);
          errorMsg.classList.add("js-hidden");
        };

        const passwordStrength = (input, strengthBar, btn) => {
          //getting password
          const passw = getPasswordVal(input);
          //check if there is an error
          const error = testPasswError(passw);

          if (error) {
            showErrorMsg(input);
          } else {
            //hide error messages
            hideErrorMsg(input);
            //finding strength
            const strength = testPassw(passw);
            //setting strength bar (value and styles)
            setStrengthBar(strengthBar, strength);
            //unblock submit btn only if password is moderate or stronger
            unblockSubmitBtn(btn, strength);
          }
        };

        const passwordVisible = (passwField) => {
          const passwType = passwField.getAttribute("type");
          let visibilityStatus;
          if (passwType === "text") {
            passwField.setAttribute("type", "password");
            visibilityStatus = "hidden";
          } else {
            passwField.setAttribute("type", "text");
            visibilityStatus = "visible";
          }
          return visibilityStatus;
        };

        const changeVisibiltyBtnIcon = (btn, status) => {
          const hiddenPasswIcon = btn.querySelector(
            `${DOM.passwVisibility_icon}[data-visible="hidden"]`
          );
          const visibilePasswIcon = btn.querySelector(
            `${DOM.passwVisibility_icon}[data-visible="visible"]`
          );

          if (status === "visible") {
            visibilePasswIcon.classList.remove("js-hidden");
            hiddenPasswIcon.classList.add("js-hidden");
          } else if (status === "hidden") {
            visibilePasswIcon.classList.add("js-hidden");
            hiddenPasswIcon.classList.remove("js-hidden");
          }
        };

        const passwVisibilitySwitcher = (passwField, visibilityToggler) => {
          const visibilityStatus = passwordVisible(passwField);
          changeVisibiltyBtnIcon(visibilityToggler, visibilityStatus);
        };

        //*** EVENT LISTENERS
        DOM.passwInput.addEventListener("input", () => {
          passwordStrength(DOM.passwInput, DOM.strengthBar, DOM.submitBtn);
        });

        const passwVisibilityBtn = document.querySelector(
          DOM.passwVisibilityBtn
        );
        passwVisibilityBtn.addEventListener("click", (e) => {
          let toggler = findParentNode(e.target, DOM.passwVisibilityBtn);
          passwVisibilitySwitcher(DOM.passwInput, toggler);
        });
      });
    </script>
  </body>
</html>
